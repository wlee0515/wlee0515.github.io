<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Fourier Transform Demo</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: white;
    }

    #div_display {
      width: 100%;
      height: 100%;
    }

    #div_status {
      position: fixed;
      top: 3px;
      left: 3px;
      padding: 5px;
    }

    #div_menu {
      position: fixed;
      top: 3px;
      right: 3px;
      padding: 5px;
      text-align: right;
    }

    .hidden {
      display: none;
    }

    #div_control_grid {
      display: inline-grid;
      grid-template-columns: auto auto;
    }

    button {
      width: 75px;
      height: 75px;
      margin: 5px;
    }
  </style>
  <script type="text/javascript">

    // Global Variables
    var gFourierTransformCoefficients = [];
    var gOrder = -1;
    var gOrderLimit = 10000;
    var gTime = 2;
    var gDrawSpeed = 1;

    var gEndPointX = 0;
    var gEndPointY = 0;
    var gZoom = 0.0;

    function init() {
      resize();

      setInterval(processTick, 25);
    }

    function resize() {
      var wCanvas = document.getElementById("display");
      if (null != wCanvas) {
        wCanvas.width = wCanvas.parentNode.clientWidth - 2;
        wCanvas.height = wCanvas.parentNode.clientHeight - 2;
      }
    }

    function processTick() {
      var wCanvas = document.getElementById("display");
      if (null != wCanvas) {
        clearCanvas(wCanvas);
        var zoom = Math.pow(2, gZoom);
        drawCanvasCenteredAt(wCanvas, drawCanvas, wCanvas.width / 2 - zoom * gEndPointX, wCanvas.height / 2 - zoom * gEndPointY, 0, zoom);
      }
    }
    function clearCanvas(iDOM) {
      var wCtx = iDOM.getContext("2d");
      wCtx.clearRect(0, 0, iDOM.width, iDOM.height);
    }

    function drawCanvasCenteredAt(iDOM, iDrawFunction, iTranslateX, iTranslateY, iRotation, iScale) {

      var wXTranslate = iTranslateX;
      var wYTranslate = iTranslateY;
      var wRotate = iRotation;
      var wScale = iScale;

      var wCtx = iDOM.getContext("2d");

      wCtx.translate(wXTranslate, wYTranslate);
      wCtx.scale(wScale, wScale);
      wCtx.rotate(wRotate);

      iDrawFunction(iDOM);

      wCtx.rotate(-wRotate);
      wCtx.scale(1 / wScale, 1 / wScale);
      wCtx.translate(-wXTranslate, -wYTranslate);
    }

    function drawCanvas(iDOM) {
      var wSampleSize = 1000;
      var wT0 = 0;
      var wT1 = 1;
      var wTStep = (wT1 - wT0) / wSampleSize;

      if (wT1 <= gTime) {
        gTime = wT0;

        if (gOrder < gOrderLimit) {
          gOrder++;

          gFourierTransformCoefficients.push(
            calculateFourierTransformCoefficient(gOrder, complexFunction1)
          );

          if (gOrder != 0) {
            gFourierTransformCoefficients.push(
              calculateFourierTransformCoefficient(-gOrder, complexFunction1)
            );
          }
          else {
            gTime = wT1;
          }

          var wStatus = document.getElementById("div_status");
          wStatus.innerText = "Number of Coefficients used : " + (2*gOrder + 1);
        }
      }
      gTime += gDrawSpeed * wTStep;

      var wCtx = iDOM.getContext("2d");

      // Draw Base Image
      wCtx.beginPath();
      wCtx.lineJoin = "round";

      for (var wi = wT0; wi < wT1; wi += wTStep) {
        var wT = wi;

        var wPt = complexFunction1(wT);
        var wX = wPt.Real;
        var wY = wPt.Imaginary;

        if (wT0 == wi) {
          wCtx.moveTo(wX, wY);
        } else {
          wCtx.lineTo(wX, wY);
        }
      }

      wCtx.strokeStyle = "blue";
      wCtx.lineWidth = 1;
      wCtx.stroke();

      // Draw Fourier Transformed Vector

      var wXBase = 0;
      var wYBase = 0;
      for (var wk = 0; wk < gFourierTransformCoefficients.length; wk++) {
        var wComponent = gFourierTransformCoefficients[wk];

        var wCos = Math.cos(wComponent.Order * 2 * Math.PI * gTime);
        var wSin = Math.sin(wComponent.Order * 2 * Math.PI * gTime);

        var wReal = wCos * wComponent.Real - wSin * wComponent.Imaginary;
        var wImaginary = wSin * wComponent.Real + wCos * wComponent.Imaginary;

        var wAngle = Math.atan2(wImaginary, wReal);
        var wScale = Math.sqrt(wReal * wReal + wImaginary * wImaginary) / 100; // Vector is 100px in length

        drawCanvasCenteredAt(iDOM, drawArrow, wXBase, wYBase, wAngle, wScale);

        wXBase += wReal;
        wYBase += wImaginary;
      }

      // Draw Fourier Transformed Image Order=-1
      
      wCtx.beginPath();
      wCtx.lineJoin = "round";

      for (var wi = gTime; wi <= wT1; wi += wTStep) {
        var wT = wi;

        var wX = 0;
        var wY = 0;
        for (var wk = 0; wk < gFourierTransformCoefficients.length - 2; wk++) {
          var wComponent = gFourierTransformCoefficients[wk];

          var wCos = Math.cos(wComponent.Order * 2 * Math.PI * wT);
          var wSin = Math.sin(wComponent.Order * 2 * Math.PI * wT);

          var wReal = wCos * wComponent.Real - wSin * wComponent.Imaginary;
          var wImaginary = wSin * wComponent.Real + wCos * wComponent.Imaginary;

          wX += wReal;
          wY += wImaginary;
        }

        if (wT0 == wi) {
          wCtx.moveTo(wX, wY);
        } else {
          wCtx.lineTo(wX, wY);
        }
      }

      wCtx.strokeStyle = "red";
      wCtx.lineWidth = 1;
      wCtx.stroke();

      // Draw Fourier Transformed Image Order

      wCtx.beginPath();
      wCtx.lineJoin = "round";

      for (var wi = wT0; wi <= gTime; wi += wTStep) {
        var wT = wi;

        var wX = 0;
        var wY = 0;
        for (var wk = 0; wk < gFourierTransformCoefficients.length; wk++) {
          var wComponent = gFourierTransformCoefficients[wk];

          var wCos = Math.cos(wComponent.Order * 2 * Math.PI * wT);
          var wSin = Math.sin(wComponent.Order * 2 * Math.PI * wT);

          var wReal = wCos * wComponent.Real - wSin * wComponent.Imaginary;
          var wImaginary = wSin * wComponent.Real + wCos * wComponent.Imaginary;

          wX += wReal;
          wY += wImaginary;
        }

        if (wT0 == wi) {
          wCtx.moveTo(wX, wY);
        } else {
          wCtx.lineTo(wX, wY);
        }
      }

      wCtx.strokeStyle = "red";
      wCtx.lineWidth = 1;
      wCtx.stroke();

      var q = 0.1;
      gEndPointX = (1 - q) * gEndPointX + q * wXBase;
      gEndPointY = (1 - q) * gEndPointY + q * wYBase;
    }

    function calculateFourierTransformCoefficient(iOrder, iComplexFunction) {
      var wSampleSize = 10000;
      var wT0 = 0;
      var wT1 = 1;
      var wTStep = (wT1 - wT0) / wSampleSize;

      var wWaveLength = -1 * iOrder * 2 * Math.PI;
      var wSum = {
        Order: iOrder,
        Real: 0,
        Imaginary: 0
      };

      for (var wi = wT0; wi <= wT1; wi += wTStep) {
        var wT = wi;
        var wAngle = wWaveLength * wT;
        var wEvaluateFunction = iComplexFunction(wT);

        var wCos = Math.cos(wAngle);
        var wSin = Math.sin(wAngle);

        var wReal =
          wCos * wEvaluateFunction.Real - wSin * wEvaluateFunction.Imaginary;
        var wImaginary =
          wSin * wEvaluateFunction.Real + wCos * wEvaluateFunction.Imaginary;

        wSum.Real += wTStep * wReal;
        wSum.Imaginary += wTStep * wImaginary;
      }

      return wSum;
    }

    function drawArrow(iDOM) {
      var wCtx = iDOM.getContext("2d");

      wCtx.beginPath();
      wCtx.arc(0, 0, 100, 0, 2 * Math.PI);

      wCtx.strokeStyle = "gray";
      wCtx.lineWidth = 1;
      wCtx.stroke();

      wCtx.beginPath();
      wCtx.moveTo(0, 0);
      wCtx.lineTo(0, 1);
      wCtx.lineTo(90, 1);
      wCtx.lineTo(90, 3);
      wCtx.lineTo(100, 0);
      wCtx.lineTo(90, -3);
      wCtx.lineTo(90, -1);
      wCtx.lineTo(0, -1);
      wCtx.closePath();

      wCtx.lineJoin = "round";

      wCtx.fillStyle = "lime";
      wCtx.lineWidth = 0.1;
      wCtx.stroke();
      wCtx.fill();
    }

    function complexFunction1(iDt) {
      return getPathArray(iDt)
    }

    function getPathArray(iDt) {
      var wPointArray = fox();
      //var wPointArray = text();
      
      var wPt = iDt * wPointArray.length;
      var wP1 = Math.floor(wPt);
      var wP2 = Math.ceil(wPt);

      var wReal = 0;
      var wImaginary = 0;
      if (wP2 == 0) {
        wReal = wPointArray[0][0];
        wImaginary = wPointArray[0][1];
      }
      else if (wP2 == wPointArray.length) {
        wReal = wPointArray[wPointArray.length-1][0];
        wImaginary = wPointArray[wPointArray.length-1][1];
      }
      else {
        var wTravel = (wPt - wP1) / (wP2 -wP1);
        wReal = wTravel*(wPointArray[wP2][0] - wPointArray[wP1][0]) + wPointArray[wP1][0];
        wImaginary = wTravel*(wPointArray[wP2][1] - wPointArray[wP1][1]) + wPointArray[wP1][1];
      }

      return {
        Real : wReal,
        Imaginary : wImaginary
      }
    }

    var gFoxArray = [];
    function fox() {

      //return [[490.832,272.416],[440.380,210.950],[435.530,203.121],[422.808,52.656],[410.907,33.451],[341.742,112.795],[256.000,97.317],[170.258,112.796],[101.093,33.452],[89.191,52.658],[76.469,203.123],[71.619,210.952],[21.167,272.418],[0.000,286.169],[20.954,300.246],[174.217,412.189],[196.997,438.844],[256.001,478.551],[315.005,438.844],[337.785,412.189],[491.048,300.246],[512.002,286.169],[490.832,272.416]];
    
    
      if (0 == gFoxArray.length) {
        var wImage = document.querySelector("#svg_fox1");
        var wPath = wImage.querySelector("#FoxFace");
      
        var wTotalLength = wPath.getTotalLength()
        for (var i = 0; i <= 1.0; i+=0.004) {
          var pos = wPath.getPointAtLength(wTotalLength*i);
          gFoxArray.push([pos.x, pos.y]);
        }
      }

      return gFoxArray;
    }

    function text() {
      return [[82.810,-73.300],[82.810,-73.300],[82.810,-73.300],[66.000,-51.350],[66.000,-51.350],[66.000,-51.350],[50.620,-24.700],[50.620,-24.700],[50.620,-24.700],[41.650,-6.370],[41.650,-6.370],[41.650,-6.370],[34.690,3.920],[34.690,3.920],[34.690,3.920],[33.120,-0.390],[33.120,-0.390],[33.120,-0.390],[34.400,-7.940],[34.400,-7.940],[34.400,-7.940],[37.040,-15.190],[37.040,-15.190],[38.320,-18.030],[38.320,-18.030],[41.650,-32.830],[41.650,-32.830],[41.650,-32.830],[36.360,-50.960],[36.360,-50.960],[36.360,-50.960],[15.580,-12.740],[15.580,-12.740],[15.580,-12.740],[13.130,-8.920],[13.130,-8.920],[13.130,-8.920],[9.410,-3.680],[9.410,-3.680],[9.410,-3.680],[4.800,1.570],[4.800,1.570],[4.800,1.570],[0.980,3.630],[0.980,3.630],[0.980,3.630],[0.100,2.550],[0.100,2.550],[0.200,1.670],[0.200,1.670],[12.540,-23.030],[12.540,-23.030],[31.160,-55.960],[31.160,-55.960],[22.830,-58.310],[22.830,-58.310],[22.830,-58.310],[15.730,-55.570],[15.730,-55.570],[15.730,-55.570],[13.130,-48.220],[13.130,-48.220],[13.130,-48.220],[13.620,-44.490],[13.620,-44.490],[13.620,-44.490],[13.920,-43.120],[13.920,-43.120],[13.920,-43.120],[13.230,-42.240],[13.230,-42.240],[13.230,-42.240],[9.410,-46.450],[9.410,-46.450],[9.410,-46.450],[7.250,-53.610],[7.250,-53.610],[7.250,-53.610],[10.140,-60.030],[10.140,-60.030],[10.140,-60.030],[17.840,-62.330],[17.840,-62.330],[17.840,-62.330],[32.440,-58.110],[32.440,-58.110],[42.140,-75.260],[42.140,-75.260],[43.710,-76.240],[43.710,-76.240],[43.710,-76.240],[44.690,-74.480],[44.690,-74.480],[44.690,-74.480],[37.530,-53.610],[37.530,-53.610],[37.530,-53.610],[44.880,-30.580],[44.880,-30.580],[44.880,-30.580],[45.370,-29.600],[45.370,-29.600],[45.370,-29.600],[45.960,-30.380],[45.960,-30.380],[45.960,-30.380],[56.060,-49.590],[56.060,-49.590],[56.060,-49.590],[68.550,-68.260],[68.550,-68.260],[68.550,-68.260],[82.320,-75.460],[82.320,-75.460],[82.320,-75.460],[83.790,-74.870],[83.790,-74.870],[83.790,-74.870],[82.810,-73.300]];
    }
  </script>

  <script>

    function ZoomIn() {
      gZoom++;
    }

    function ZoomOut() {
      gZoom--;
    }

    function SpeedUp() {
      gDrawSpeed++;
    }

    function SlowDown() {
      gDrawSpeed--;
      if (gDrawSpeed <= 1) {
        gDrawSpeed = 1;
      }
    }



  </script>

  <style>
    .menu_icon_container {
      display: inline-block;
      cursor: pointer;
    }

    .bar1,
    .bar2,
    .bar3 {
      width: 35px;
      height: 5px;
      background-color: #333;
      margin: 5px 0;
      transition: 0.4s;
    }

    .change .bar1 {
      -webkit-transform: translate(0px, 10.5px) rotate(-45deg);
      transform: translate(0px, 10.5px) rotate(-45deg);
    }

    .change .bar2 {
      opacity: 0;
    }

    .change .bar3 {
      -webkit-transform: translate(0px, -10.5px) rotate(45deg);
      transform: translate(0px, -10.5px) rotate(45deg);
    }
  </style>
  <script>

    function myFunction(x) {
      x.classList.toggle("change");

      var wControl = document.getElementById("div_control");
      wControl.classList.toggle("hidden");
    }

  </script>
</head>

<body onload="init()" onresize="resize()">
  <div id="div_display">
    <canvas id="display" style="border:1px solid #999"></canvas>
  </div>
  <div id="div_status">
  </div>
  <div id="div_menu">
    <div class="menu_icon_container" onclick="myFunction(this)">
      <div class="bar1"></div>
      <div class="bar2"></div>
      <div class="bar3"></div>
    </div>
    <div id="div_control" class="hidden">
      <div id="div_control_grid">
        <button onclick="ZoomIn()">Zoom In</button>
        <button onclick="ZoomOut()">Zoom Out</button>
        <button onclick="SpeedUp()">Speed Up</button>
        <button onclick="SlowDown()">Slow Down</button>
      </div>
    </div>
  </div>
  <svg data="../../images/fox1.svg" type="image/svg+xml" id="svg_fox1" style="display: none;">
    <g>
        <g>
          <path id="FoxFace"  d="M490.832,272.416c-20.897-13.576-35.254-36.838-50.452-61.466c-1.59-2.576-3.209-5.194-4.85-7.829
            c28.834-81.877-10.957-147.618-12.722-150.465l-11.901-19.205l-69.165,79.344C317.14,102.419,288.769,97.317,256,97.317
            s-61.14,5.103-85.742,15.479l-69.165-79.344L89.191,52.658c-1.763,2.846-41.556,68.587-12.722,150.465
            c-1.641,2.635-3.26,5.252-4.85,7.829c-15.198,24.628-29.554,47.889-50.452,61.466L0,286.169l20.954,14.077
            c1.247,0.838,125.11,84.155,153.263,111.943c8.852,8.737,15.932,17.845,22.78,26.655c15.175,19.521,30.866,39.707,59.004,39.707
            c28.138,0,43.83-20.186,59.004-39.707c6.848-8.809,13.928-17.918,22.78-26.655c28.152-27.788,152.016-111.105,153.263-111.943
            l20.954-14.077L490.832,272.416z" />
            
            <path id="FoxFace2"  d="M208.671,400.249c-3.389-3.906-7.035-7.864-11.023-11.8
            c-21.811-21.527-91.169-70.116-130.445-97.081c22.1-6.25,54.547-13.032,91.294-13.032c11.425,0,20.061,3.447,27.18,10.846
            C206.78,311.119,209.237,362.415,208.671,400.249z M255.999,445.196c-5.61,0-10.226-2.147-15.171-6.513
            c0.097-3.435,0.248-7.35,0.414-11.623c0.017-0.429,0.033-0.879,0.05-1.314h29.417c0.017,0.435,0.034,0.885,0.05,1.314
            c0.166,4.273,0.317,8.189,0.414,11.623C266.227,443.049,261.609,445.196,255.999,445.196z M314.353,388.45
            c-3.988,3.936-7.634,7.895-11.023,11.8c-0.566-37.834,1.891-89.13,22.994-111.067c7.118-7.399,15.755-10.846,27.181-10.846
            c36.747,0,69.193,6.782,91.294,13.032C405.521,318.332,336.163,366.922,314.353,388.45z"/>
        </g>
      </g>
      <g>
        <g>
          <path d="M360.456,291.91c-9.304,0-16.851,7.54-16.851,16.84c0,9.301,7.547,16.84,16.851,16.84c9.293,0,16.839-7.54,16.839-16.84
            C377.296,299.45,369.749,291.91,360.456,291.91z"/>
        </g>
      </g>
      <g>
        <g>
          <path d="M151.555,291.91c-9.304,0-16.851,7.54-16.851,16.84c0,9.301,7.547,16.84,16.851,16.84c9.293,0,16.839-7.54,16.839-16.84
            C168.395,299.45,160.848,291.91,151.555,291.91z"/>
        </g>
      </g>
  </svg>
</body>

</html>