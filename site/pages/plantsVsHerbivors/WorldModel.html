<html>

<head>
  <meta name="description"
    content="A Demonstration of an Artificial world simulation with Dave Ackley's Plants vs Herbivores applete programmed by Wilson Lee @Heap Art">
  <meta name="keywords"
    content="Heap Art, artificial life, life simulation, Plants vs Herbivores, Dave Ackley, Wilson Lee">
  <meta name="author" content="Wilson Lee @Heap Art">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <Title>Heap Art - Plants vs Herbivores, Artificial Life Simulation</Title>
  <script>

    //---------------------------------------------------------------
    // Helper Functions
    //---------------------------------------------------------------

    function getImgPixelData(iCanvas) {

      var wInputWidth = iCanvas.width;
      var wInputHeight = iCanvas.height;
      var wInputCtx = iCanvas.getContext('2d');
      const wInputImageData = wInputCtx.getImageData(0, 0, wInputWidth, wInputHeight);
      const wInputPixelArray = wInputImageData.data;

      return {
        width: wInputWidth,
        height: wInputHeight,
        ctx: wInputCtx,
        imageData: wInputImageData,
        pixelArray: wInputPixelArray
      }
    }

    function driftColor(iDriftMax, iNumber) {
      if (Math.random() > 0.5) {
        return iNumber;
      }

      var wDrift = Math.round(iDriftMax * (2 * Math.random() - 1));
      var wNewColor = iNumber + wDrift;
      if (wNewColor > 255) wNewColor = 255;
      else if (wNewColor < 0) wNewColor = 0;
      return wNewColor;
    }

    //---------------------------------------------------------------
    // Global Variables
    //---------------------------------------------------------------

    eWorld_Layer = {
      Lightning: 0,
      Plants: 1,
      Herbivores: 2,
    }

    active_Layers = {
      Lightning: true,
      Plants: true,
      Herbivores: true,
    }

    gSimParameters = {
      RandomLightning: 0.0001,
      RandomPlantLife: 0.000001,
      RandomHerbivoreLife: 0.000001,

      PlantEnergyChangeIt: 10,
      PlantReproductionThreshold: 250,
      PlantReproductionCost: 100,
      PlantBirthEnergy: 1,
      PlantGeneDrift: 5,

      HerbivoreEnergyChangeIt: -1,
      HerbivoreEnergyChangeStep: -5,
      HerbivoreReproductionThreshold: 250,
      HerbivoreReproductionCost: 100,
      HerbivoreBirthEnergy: 100,
      HerbivoreGeneDrift: 5,

      AppetiteRange: 50,

      IterationTimeMs: 50
    }

    gWorldModel = {
      DisplayCanvas: null,
      Layer: [],
      Counts: [],
      SpriteScale: 5,
      width: 10,
      height: 10,

      DisplayLayers: [],
      DisplayIndex: 0,
      DisplayIndexNext: 0,
      DisplayFrameCount: 2,
      SpriteImg: {}
    }

    //---------------------------------------------------------------
    // Global Variables
    //---------------------------------------------------------------

    window.addEventListener("load", function () {
      setup();
      setInterval(iteration, gSimParameters.IterationTimeMs);
    })

    function setup() {

      var wSimulationViewPoint = document.getElementById("id_SimulationViewPoint_canvas");
      if (null != wSimulationViewPoint) {
        gWorldModel.DisplayCanvas = wSimulationViewPoint;
        gWorldModel.width = Math.ceil(gWorldModel.DisplayCanvas.width / gWorldModel.SpriteScale);
        gWorldModel.height = Math.ceil(gWorldModel.DisplayCanvas.height / gWorldModel.SpriteScale);
      }

      var wArrayLength = gWorldModel.width * gWorldModel.height * 4;

      var wWorldLayers = Object.keys(eWorld_Layer);
      for (var wi = 0; wi < wWorldLayers.length; ++wi) {
        var wNewArray = []
        for (var wj = 0; wj < gWorldModel.DisplayFrameCount; ++wj) {
          var wNewLayer = new Uint8ClampedArray(wArrayLength);
          for (var wk = 0; wk < wNewLayer.length; ++wk) {
            wNewLayer[wk] = 0;
          }
          wNewArray.push(wNewLayer);

        }

        gWorldModel.Layer.push(wNewArray);
        gWorldModel.Counts.push(0);
      }

      gWorldModel.DisplayLayers = Object.keys(eWorld_Layer);


      gWorldModel.SpriteImg["Lightning"] =
        [[0, 0, 0, 1, 0]
          , [0, 0, 1, 0, 0]
          , [0, 1, 1, 1, 0]
          , [0, 0, 1, 0, 0]
          , [0, 1, 0, 0, 0]]

      gWorldModel.SpriteImg["Plants"] =
        [[0.3, 1.0, 0.5, 1.0, 0.3]
          , [1.0, 0.3, 0.7, 0.3, 1.0]
          , [0.5, 0.7, 1.0, 0.7, 0.5]
          , [1.0, 0.3, 0.7, 0.3, 1.0]
          , [0.3, 1.0, 0.5, 1.0, 0.3]]


      gWorldModel.SpriteImg["Herbivores"] =
        [[1, 0, 0, 0, 1]
          , [1, 1, 0, 1, 1]
          , [0, 1, 1, 1, 0]
          , [0, 1, 1, 1, 0]
          , [0, 0, 1, 0, 0]]

      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);
    }


    function resizeCanvas() {
      if (null != gWorldModel.DisplayCanvas) {

        var wWorldDisplayWidth = gWorldModel.DisplayCanvas.parentElement.clientWidth;
        var wWorldDisplayHeight = gWorldModel.DisplayCanvas.parentElement.clientHeight;

        gWorldModel.DisplayCanvas.width = wWorldDisplayWidth;
        gWorldModel.DisplayCanvas.height = wWorldDisplayHeight;

        var wOldWorldWidth = gWorldModel.width;
        var wOldWorldHeight = gWorldModel.height;

        gWorldModel.width = Math.ceil(wWorldDisplayWidth / gWorldModel.SpriteScale);
        gWorldModel.height = Math.ceil(wWorldDisplayHeight / gWorldModel.SpriteScale);

        var wArrayLength = gWorldModel.width * gWorldModel.height * 4;

        for (var wi = 0; wi < gWorldModel.Layer.length; ++wi) {
          for (var wj = 0; wj < gWorldModel.Layer[wi].length; ++wj) {
            var wNewLayer = new Uint8ClampedArray(wArrayLength);
            var wOldLayer = gWorldModel.Layer[wi][wj];

            var wIndex, wOldIndex;
            for (var wX = 0; wX < gWorldModel.width; ++wX) {
              for (var wY = 0; wY < gWorldModel.height; ++wY) {
                wIndex = (wY * gWorldModel.width + wX) * 4;

                if ((wX < wOldWorldWidth) && (wY < wOldWorldHeight)) {
                  wOldIndex = (wY * wOldWorldWidth + wX) * 4;

                  wNewLayer[wIndex] = wOldLayer[wOldIndex];
                  wNewLayer[wIndex + 1] = wOldLayer[wOldIndex + 1];
                  wNewLayer[wIndex + 2] = wOldLayer[wOldIndex + 2];
                  wNewLayer[wIndex + 3] = wOldLayer[wOldIndex + 3];
                }
                else {

                  wNewLayer[wIndex] = 0;
                  wNewLayer[wIndex + 1] = 0;
                  wNewLayer[wIndex + 2] = 0;
                  wNewLayer[wIndex + 3] = 0;
                }
              }
            }

            gWorldModel.Layer[wi][wj] = wNewLayer;
          }
        }
      }
    }


    function iteration() {

      gWorldModel.DisplayIndex = (gWorldModel.DisplayIndex + 1) % 2;
      gWorldModel.DisplayIndexNext = (gWorldModel.DisplayIndex + 1) % 2;

      process();
      render();
      outputHtml();

    }

    function process() {

      for (var wi = 0; wi < gWorldModel.Layer.length; ++wi) {
        var wWorkingLayer = gWorldModel.Layer[wi][gWorldModel.DisplayIndexNext];
        for (var wk = 0; wk < wWorkingLayer.length; ++wk) {
          wWorkingLayer[wk] = 0;
        }
      }

      var wLightningImg = gWorldModel.Layer[eWorld_Layer.Lightning][gWorldModel.DisplayIndex];
      var wLightningImgNew = gWorldModel.Layer[eWorld_Layer.Lightning][gWorldModel.DisplayIndexNext];

      var wPlantsImg = gWorldModel.Layer[eWorld_Layer.Plants][gWorldModel.DisplayIndex];
      var wPlantsImgNew = gWorldModel.Layer[eWorld_Layer.Plants][gWorldModel.DisplayIndexNext];

      var wHerbivoresImg = gWorldModel.Layer[eWorld_Layer.Herbivores][gWorldModel.DisplayIndex];
      var wHerbivoresImgNew = gWorldModel.Layer[eWorld_Layer.Herbivores][gWorldModel.DisplayIndexNext];

      var wTargetIndicesArr = [[-1, -1], [+0, -1], [+1, -1],
      [-1, +0], [+1, +0],
      [-1, +1], [+0, +1], [+1, +1]];

      var wInputWidth = gWorldModel.width;
      var wInputHeight = gWorldModel.height;
      var wIndex, wTargetIndex, wHasTarget;
      var wNewX, wNewY;

      var wSpawnPlant = gWorldModel.Counts[eWorld_Layer.Plants] < 2;
      var wSpawnHerbivore = gWorldModel.Counts[eWorld_Layer.Herbivores] < 2;

      var wAppetiteRangeSq = gSimParameters.AppetiteRange*gSimParameters.AppetiteRange;

      for (var wX = 0; wX < wInputWidth; ++wX) {
        for (var wY = 0; wY < wInputHeight; ++wY) {

          wIndex = (wY * wInputWidth + wX) * 4;

          if (true == active_Layers.Plants) {

            wPlantLife = wPlantsImg[wIndex + 3];
            if (0 != wPlantLife) {
              wNewPlantLife = wPlantLife + gSimParameters.PlantEnergyChangeIt;

              var wRandomIndex = Math.floor(wTargetIndicesArr.length * Math.random());
              var wTargetOffset = wTargetIndicesArr[wRandomIndex];
              wNewX = wX + wTargetOffset[0];
              wNewX = wNewX < 0 ? 0 : wNewX >= wInputWidth ? wInputWidth - 1 : wNewX;
              wNewY = wY + wTargetOffset[1];
              wNewY = wNewY < 0 ? 0 : wNewY >= wInputHeight ? wInputHeight - 1 : wNewY;

              wTargetIndex = (wNewY * wInputWidth + wNewX) * 4;

              wHasTarget = wIndex != wTargetIndex;

              if (true == wHasTarget) {
                if (wNewPlantLife > gSimParameters.PlantReproductionThreshold) {
                  wTargetPlantLife = wPlantsImg[wTargetIndex + 3];
                  if (0 == wTargetPlantLife) {
                    wTargetPlantLifeNext = wPlantsImgNew[wTargetIndex + 3];
                    if (0 == wTargetPlantLifeNext) {
                      wPlantsImgNew[wTargetIndex + 3] = gSimParameters.PlantBirthEnergy;

                      wPlantsImgNew[wTargetIndex] = driftColor(gSimParameters.PlantGeneDrift, wPlantsImg[wIndex]);      // red
                      wPlantsImgNew[wTargetIndex + 1] = driftColor(gSimParameters.PlantGeneDrift, wPlantsImg[wIndex + 1]); // green
                      wPlantsImgNew[wTargetIndex + 2] = driftColor(gSimParameters.PlantGeneDrift, wPlantsImg[wIndex + 2]); // blue

                      wNewPlantLife -= gSimParameters.PlantReproductionCost;
                    }
                  }
                }
              }

              if (wNewPlantLife > 255) wNewPlantLife = 255;

              wPlantsImgNew[wIndex + 3] = wNewPlantLife;
              wPlantsImgNew[wIndex] = wPlantsImg[wIndex];      // red
              wPlantsImgNew[wIndex + 1] = wPlantsImg[wIndex + 1]; // green
              wPlantsImgNew[wIndex + 2] = wPlantsImg[wIndex + 2]; // blue
            }
            else {
              if (true == wSpawnPlant) {
                wPlantLifeNext = wPlantsImgNew[wIndex + 3];
                if (0 == wPlantLifeNext) {
                  if (Math.random() < gSimParameters.RandomPlantLife) {
                    wPlantsImgNew[wIndex + 3] = gSimParameters.PlantBirthEnergy;
                    wPlantsImgNew[wIndex] = 0; // red
                    wPlantsImgNew[wIndex + 1] = 255; // green
                    wPlantsImgNew[wIndex + 2] = 0; // blue
                  }
                }
              }
            }
          }

          if (true == active_Layers.Herbivores) {
            wHerbivoreLife = wHerbivoresImg[wIndex + 3];
            if (0 != wHerbivoreLife) {
              wNewHerbivoreLife = wHerbivoreLife + gSimParameters.HerbivoreEnergyChangeIt;

              var wInvR = 255 - wHerbivoresImg[wIndex];
              var wInvG = 255 - wHerbivoresImg[wIndex + 1];
              var wInvB = 255 - wHerbivoresImg[wIndex + 2];
              
              var wEDiffR = wInvR - wPlantsImgNew[wIndex];
              var wEDiffG = wInvG - wPlantsImgNew[wIndex + 1];
              var wEDiffB = wInvB - wPlantsImgNew[wIndex + 2];
              var wEDist = wEDiffR * wEDiffR + wEDiffG * wEDiffG + wEDiffB * wEDiffB;

              if (wEDist < wAppetiteRangeSq) {
                wNewHerbivoreLife += Math.floor(0.1 * (wPlantsImgNew[wIndex + 3]));
                wPlantsImgNew[wIndex + 3] = 0;
              }

              if (wNewHerbivoreLife > 255) wNewHerbivoreLife = 255;
              if (wNewHerbivoreLife < 0) wNewHerbivoreLife = 0;

              var wRandomIndex = Math.floor(wTargetIndicesArr.length * Math.random());

              var wTargetOffset = wTargetIndicesArr[(wRandomIndex + wi) % wTargetIndicesArr.length];
              wNewX = wX + wTargetOffset[0];
              wNewX = wNewX < 0 ? 0 : wNewX >= wInputWidth ? wInputWidth - 1 : wNewX;
              wNewY = wY + wTargetOffset[1];
              wNewY = wNewY < 0 ? 0 : wNewY >= wInputHeight ? wInputHeight - 1 : wNewY;

              wTargetIndex = (wNewY * wInputWidth + wNewX) * 4;
              var wDiffA = 255 - wPlantsImgNew[wTargetIndex + 3];
              var wDiffR = wInvR - wPlantsImgNew[wTargetIndex];
              var wDiffG = wInvG - wPlantsImgNew[wTargetIndex + 1];
              var wDiffB = wInvB - wPlantsImgNew[wTargetIndex + 2];
              var wDist = wDiffA*wDiffA + wDiffR * wDiffR + wDiffG * wDiffG + wDiffB * wDiffB;

              for (var wi = 0; wi < wTargetIndicesArr.length; ++wi) {
                var wTargetOffset = wTargetIndicesArr[(wTargetIndicesArr.length + wRandomIndex - wi) % wTargetIndicesArr.length];
                wNewX = wX + wTargetOffset[0];
                wNewX = wNewX < 0 ? 0 : wNewX >= wInputWidth ? wInputWidth - 1 : wNewX;
                wNewY = wY + wTargetOffset[1];
                wNewY = wNewY < 0 ? 0 : wNewY >= wInputHeight ? wInputHeight - 1 : wNewY;

                var wTempTargetIndex = (wNewY * wInputWidth + wNewX) * 4;
                if (wIndex != wTempTargetIndex) {
                  var wTDiffA = 255 - wPlantsImg[wTargetIndex + 3];
                  var wTDiffR = wInvR - wPlantsImg[wTargetIndex];
                  var wTDiffG = wInvG - wPlantsImg[wTargetIndex + 1];
                  var wTDiffB = wInvB - wPlantsImg[wTargetIndex + 2];
                  var wTDist = wTDiffA * wTDiffA + wTDiffR * wTDiffR + wTDiffG * wTDiffG + wTDiffB * wTDiffB;

                  if (wTDist < wDist) {
                    wDist = wTDist;
                    wTargetIndex = wTempTargetIndex;
                  }
                }
              }

              wHasTarget = wIndex != wTargetIndex;

              var wMoved = false;
              if (true == wHasTarget) {
                wTargetHerbivoreLife = wHerbivoresImg[wTargetIndex + 3];
                if (0 == wTargetHerbivoreLife) {
                  wTargetHerbivoreLifeNext = wHerbivoresImgNew[wTargetIndex + 3];
                  if (0 == wTargetHerbivoreLifeNext) {

                    if (wNewHerbivoreLife > gSimParameters.HerbivoreReproductionThreshold) {

                      wNewHerbivoreLife -= gSimParameters.HerbivoreReproductionCost;

                      wHerbivoresImgNew[wTargetIndex + 3] = gSimParameters.HerbivoreBirthEnergy;
                      wHerbivoresImgNew[wTargetIndex] = driftColor(gSimParameters.HerbivoreGeneDrift, wHerbivoresImg[wIndex]);      // red
                      wHerbivoresImgNew[wTargetIndex + 1] = driftColor(gSimParameters.HerbivoreGeneDrift, wHerbivoresImg[wIndex + 1]); // green
                      wHerbivoresImgNew[wTargetIndex + 2] = driftColor(gSimParameters.HerbivoreGeneDrift, wHerbivoresImg[wIndex + 2]); // blue
                    }
                    else {
                      wMoved = true;
                      wNewHerbivoreLife += gSimParameters.HerbivoreEnergyChangeStep;

                      wHerbivoresImgNew[wTargetIndex + 3] = wNewHerbivoreLife;
                      wHerbivoresImgNew[wTargetIndex] = wHerbivoresImg[wIndex];      // red
                      wHerbivoresImgNew[wTargetIndex + 1] = wHerbivoresImg[wIndex + 1]; // green
                      wHerbivoresImgNew[wTargetIndex + 2] = wHerbivoresImg[wIndex + 2]; // blue

                    }
                  }
                }
              }

              if (false == wMoved) {
                wHerbivoresImgNew[wIndex + 3] = wNewHerbivoreLife;
                wHerbivoresImgNew[wIndex] = wHerbivoresImg[wIndex];      // red
                wHerbivoresImgNew[wIndex + 1] = wHerbivoresImg[wIndex + 1]; // green
                wHerbivoresImgNew[wIndex + 2] = wHerbivoresImg[wIndex + 2]; // blue
              }
            }
            else {
              if (true == wSpawnHerbivore) {
                wHerbivoreLifeNext = wHerbivoresImgNew[wIndex + 3];
                if (0 == wHerbivoreLifeNext) {

                  if (Math.random() < gSimParameters.RandomHerbivoreLife) {

                    if (0 != wPlantsImg[wIndex + 3]) {
                      wHerbivoresImgNew[wIndex + 3] = gSimParameters.HerbivoreBirthEnergy;
                      wHerbivoresImgNew[wIndex] = 255 - wPlantsImg[wIndex]; // red
                      wHerbivoresImgNew[wIndex + 1] = 255 - wPlantsImg[wIndex + 1]; // green
                      wHerbivoresImgNew[wIndex + 2] = 255 - wPlantsImg[wIndex + 2]; // blue                  
                    }
                    else if (0 != wPlantsImgNew[wIndex + 3]) {
                      wHerbivoresImgNew[wIndex + 3] = gSimParameters.HerbivoreBirthEnergy;
                      wHerbivoresImgNew[wIndex] = 255 - wPlantsImgNew[wIndex]; // red
                      wHerbivoresImgNew[wIndex + 1] = 255 - wPlantsImgNew[wIndex + 1]; // green
                      wHerbivoresImgNew[wIndex + 2] = 255 - wPlantsImgNew[wIndex + 2]; // blue   

                    }
                    else {
                      wHerbivoresImgNew[wIndex + 3] = gSimParameters.HerbivoreBirthEnergy;
                      wHerbivoresImgNew[wIndex] = Math.round(Math.random() * 255); // red
                      wHerbivoresImgNew[wIndex + 1] = Math.round(Math.random() * 255); // green
                      wHerbivoresImgNew[wIndex + 2] = Math.round(Math.random() * 255); // blue

                    }
                  }
                }
              }
            }
          }
          if (true == active_Layers.Lightning) {

            var wLightningStrength = wLightningImg[wIndex + 3];
            if (0 != wLightningStrength) {

              var wNewLightningStrength = Math.floor(0.75 * wLightningStrength);

              wLightningImgNew[wIndex + 3] = wNewLightningStrength;
              wLightningImgNew[wIndex] = wLightningImg[wIndex]; // red
              wLightningImgNew[wIndex + 1] = wLightningImg[wIndex + 1]; // green
              wLightningImgNew[wIndex + 2] = wLightningImg[wIndex + 2]; // blue
            }
            else {
              if (Math.random() < gSimParameters.RandomLightning) {
                wLightningImgNew[wIndex + 3] = 255;
                wLightningImgNew[wIndex] = 255; // red
                wLightningImgNew[wIndex + 1] = 255; // green
                wLightningImgNew[wIndex + 2] = 255; // blue
              }
            }

            if (0 != wLightningImgNew[wIndex + 3]) {
              wPlantsImgNew[wIndex + 3] = 0;
              wHerbivoresImgNew[wIndex + 3] = 0;
            }
          }
        }
      }

      for (var wi = 0; wi < gWorldModel.Layer.length; ++wi) {
        var wWorkingLayer = gWorldModel.Layer[wi][gWorldModel.DisplayIndexNext];

        gWorldModel.Counts[wi] = 0;
        for (var wj = 0; wj < wWorkingLayer.length; wj += 4) {
          if (0 != wWorkingLayer[wj + 3]) {
            gWorldModel.Counts[wi]++;
          }
        }
      }
    }

    function render() {

      if (null == gWorldModel.DisplayCanvas) {
        return;
      }

      var wCtx = gWorldModel.DisplayCanvas.getContext('2d');
      wCtx.clearRect(0, 0, gWorldModel.DisplayCanvas.width, gWorldModel.DisplayCanvas.height);

      for (var wi = 0; wi < gWorldModel.DisplayLayers.length; ++wi) {

        var wEnum = gWorldModel.DisplayLayers[wi];
        var wKey = eWorld_Layer[wEnum];
        var wInputLayer = gWorldModel.Layer[wKey][gWorldModel.DisplayIndexNext];
        var wSprite = gWorldModel.SpriteImg[wEnum];

        drawWorldElements(gWorldModel.DisplayCanvas, wInputLayer, wSprite)
      }
    }

    function drawWorldElements(iDisplayCanvas, iElementCanvas, iDrawArray) {

      if ((null == iDrawArray) || (null == iDisplayCanvas) || (null == iElementCanvas)) {
        return;
      }

      var wInputImg = iElementCanvas;
      var wOutputImg = getImgPixelData(iDisplayCanvas);

      var wScale = Math.round(wOutputImg.width / gWorldModel.width);

      var wIndex = 0;
      for (var wX = 0; wX < gWorldModel.width; ++wX) {

        for (var wY = 0; wY < gWorldModel.height; ++wY) {
          wIndex = (wY * gWorldModel.width + wX) * 4;
          wA = wInputImg[wIndex + 3]; // alpha
          if (0 != wA) {
            wR = wInputImg[wIndex]; // red
            wG = wInputImg[wIndex + 1]; // green
            wB = wInputImg[wIndex + 2]; // blue

            var wDrawAnchorX = wX * wScale;
            var wDrawAnchorY = wY * wScale;

            var wOX, wOY, wOIndex;

            for (var wSY = 0; wSY < iDrawArray.length; ++wSY) {
              wOY = wDrawAnchorY + wSY;
              if (wOY >= wOutputImg.height) {
                continue;
              }

              for (var wSX = 0; wSX < iDrawArray[wSY].length; ++wSX) {
                wOX = wDrawAnchorX + wSX;
                if (wOX >= wOutputImg.width) {
                  continue;
                }

                wOIndex = (wOY * wOutputImg.width + wOX) * 4;

                wOutputImg.pixelArray[wOIndex] = wR;
                wOutputImg.pixelArray[wOIndex + 1] = wG;
                wOutputImg.pixelArray[wOIndex + 2] = wB;

                wOAlpha = (wA) * iDrawArray[wSY][wSX];
                wOAlpha = wOAlpha > 255 ? 255 : wOAlpha < 0 ? 0 : wOAlpha;
                wOutputImg.pixelArray[wOIndex + 3] = wOAlpha;

              }
            }
          }
        }
      }
      /*
      for (var wX = 0; wX < wOutputImg.width; ++wX) {

        for (var wY = 0; wY < wOutputImg.height; ++wY) {
          wIndex = (wY * wOutputImg.width + wX) * 4;
          wOutputImg.pixelArray[wIndex + 3] = 255; // alpha
          wOutputImg.pixelArray[wIndex] = Math.floor(255*wX/wOutputImg.width) ; // red
          wOutputImg.pixelArray[wIndex + 1] = 0; // green
          wOutputImg.pixelArray[wIndex + 2] = Math.floor(255*wY/wOutputImg.height); // blue


        }
      }

*/

      wOutputImg.ctx.putImageData(wOutputImg.imageData, 0, 0);
    }

    function outputHtml() {
      var wOutputDiv = document.getElementById("id_SimulationData_div");

      if (null != wOutputDiv) {
        var wHtml = "<h2>Element Counts</h2>";

        var wWorldLayers = Object.keys(eWorld_Layer);
        for (var wi = 0; wi < wWorldLayers.length; ++wi) {
          wHtml += "<span>" + wWorldLayers[wi] + "</span>";
          wHtml += "<span>" + gWorldModel.Counts[wi] + "</span>";
          wHtml += "</br>";
        }

        wOutputDiv.innerHTML = wHtml;
      }
    }

  </script>
  <style>
    body {
      padding: 0;
      margin: 0;
      overflow: hidden;
    }

    #id_SubCount {
      height: 110px;
      width: 350px;
      overflow: hidden;
      scroll-behavior: none;
    }

    #id_SimulationViewPoint_div {
      padding: 0;
      margin: 0;
      z-index: -100;
      width: 100vw;
      height: 100vh;
      background-color: black;
    }

    #id_SimulationData_div {
      position: fixed;
      top: 0px;
      left: 0px;
      background-color: rgba(255, 255, 255, 0.5);
      padding: 5px;
    }

    span {
      margin: 5px;
    }

    #idDebugCanvasDiv canvas {

      border: 1px solid blue;
    }

    /*
    canvas {
      border: 1px solid blue;
    }
    */
  </style>
</head>

<body>
  <!--
    <iframe id="id_SubCount" frameborder="0" src="https://freewebtools.com/live-sub-count/Heap%20Art/" allowfullscreen></iframe>
  -->
  <div id="id_SimulationViewPoint_div">
    <canvas id="id_SimulationViewPoint_canvas"></canvas>
  </div>
  <div id="id_SimulationData_div">
  </div>

</body>

</html>