<!DOCTYPE html>
<html>
  <HEAD>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <TITLE>Position Data Demo</TITLE>
    <script type="text/javascript" src="../../global/frame.js"></script>
    <script>

      /*
      const sensor = new AbsoluteOrientationSensor();
      Promise.all([navigator.permissions.query({ name: "accelerometer" }),
      navigator.permissions.query({ name: "magnetometer" }),
      navigator.permissions.query({ name: "gyroscope" })])
        .then(results => {
          if (results.every(result => result.state === "granted")) {
            sensor.start();
           // ...
          } else {
            alert("No permissions to use AbsoluteOrientationSensor.");
          }
      });
      */
    </script>
  </HEAD>
  <body>
    <canvas id="myCanvas" width="360" height="450" style="border:1px solid #d3d3d3;">
    </canvas>
    <script>
      
      function deviceOrientationListener(event) {
        var c = document.getElementById("myCanvas");
        var ctx = c.getContext("2d");

        ctx.clearRect(0, 0, c.width, c.height);
        ctx.fillStyle = "#FF7777";
        ctx.font = "14px Verdana";
        ctx.fillText("Alpha: " + Math.round(event.alpha), 10, 20);
        ctx.beginPath();
        ctx.moveTo(180, 75);
        ctx.lineTo(210, 75);
        ctx.arc(180, 75, 60, 0, event.alpha * Math.PI / 180);
        ctx.fill();

        ctx.fillStyle = "#FF6600";
        ctx.fillText("Beta: " + Math.round(event.beta), 10, 140);
        ctx.beginPath();
        ctx.fillRect(180, 150, event.beta, 90);

        ctx.fillStyle = "#FF0000";
        ctx.fillText("Gamma: " + Math.round(event.gamma), 10, 270);
        ctx.beginPath();
        ctx.fillRect(90, 340, 180, event.gamma);
      }


      if (window.DeviceOrientationEvent) {

          if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            // iOS 13+
            DeviceOrientationEvent.requestPermission()
              .then(response => {
                if (response == 'granted') {
                  window.addEventListener('deviceorientation', deviceOrientationListener)
                }
              })
              .catch(console.error)
          } else {
            window.addEventListener("deviceorientation", deviceOrientationListener);
          }

      } else {
        alert("Sorry, your browser doesn't support Device Orientation");
      }

    </script>
    <div id="DeviceMotion"></div>
    <script>
    
      function init3() {

        if (window.DeviceMotionEvent) {

          if (typeof DeviceMotionEvent.requestPermission === 'function') {
            // iOS 13+
            DeviceMotionEvent.requestPermission()
              .then(response => {
                if (response == 'granted') {
                  window.addEventListener('devicemotion', showMotion)
                }
              })
              .catch(console.error)
          } else {
            window.addEventListener("devicemotion", showMotion);
          }

        } else {
          alert("Sorry, your browser doesn't support Device Motion");
        }        
      }
      
      function showMotion(motion) {

        var wOutput = document.getElementById("DeviceMotion");
        wOutput.innerText = "";
        wOutput.innerText += "Rotation Rate Alpha : " + motion.rotationRate.alpha + "\n";
        wOutput.innerText += "Rotation Rate Beta : " + motion.rotationRate.beta + "\n";
        wOutput.innerText += "Rotation Rate Gamma : " + motion.rotationRate.gamma + "\n";

        wOutput.innerText += "Acceleration - x : " + motion.acceleration.x + "\n";
        wOutput.innerText += "Acceleration - y : " + motion.acceleration.y + "\n";
        wOutput.innerText += "Acceleration I- z : " + motion.acceleration.z + "\n";
                
        wOutput.innerText += "Acceleration Including Gravity - x : " + motion.accelerationIncludingGravity.x + "\n";
        wOutput.innerText += "Acceleration Including Gravity - y : " + motion.accelerationIncludingGravity.y + "\n";
        wOutput.innerText += "Acceleration Including Gravity - z : " + motion.accelerationIncludingGravity.z + "\n";

        wOutput.innerText += "TimeStamp : " + motion.timeStamp + "\n";
      }

      init3();
    </script>
    <div id="DeviceOrientation"></div>
    <script>
    
      function init2() {

        if (window.DeviceOrientationEvent) {

          if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            // iOS 13+
            DeviceOrientationEvent.requestPermission()
              .then(response => {
                if (response == 'granted') {
                  window.addEventListener('deviceorientation', showOrientation)
                }
              })
              .catch(console.error)
          } else {
            window.addEventListener("deviceorientation", showOrientation);
          }

        } else {
          alert("Sorry, your browser doesn't support Device Orientation");
        }        
      }
      
      function showOrientation(orientation) {
        var wOutput = document.getElementById("DeviceOrientation");
        wOutput.innerText = "";
        wOutput.innerText += "Alpha : " + orientation.alpha + "\n";
        wOutput.innerText += "Beta : " + orientation.beta + "\n";
        wOutput.innerText += "Gamma : " + orientation.gamma + "\n";
        wOutput.innerText += "Absolute : " + orientation.absolute + "\n";
      }

      init2();
    </script>
    <div id="GeoPosition"></div>
    <script>
      
      function init() {

        options = {
          enableHighAccuracy: true,
          timeout: 5000,
          maximumAge: 0
        };

        var wOutput = document.getElementById("GeoPosition");
        if (navigator.geolocation) {
         navigator.geolocation.watchPosition(showPosition, error, options);
        } else {
          wOutput.innerText = "Geolocation is not supported by this browser.";
        }
        
        //to stop 
        //navigator.geolocation.clearWatch()

        //To Pull
        //navigator.geolocation.getCurrentPosition()
      }

      
      function error(err) {
        console.warn('ERROR(' + err.code + '): ' + err.message);
      }



      function showPosition(position) {
        var wOutput = document.getElementById("GeoPosition");
        wOutput.innerText = "";
        wOutput.innerText += "Latitude : " + position.coords.latitude + "\n";
        wOutput.innerText += "Longitude : " + position.coords.longitude + "\n";
        wOutput.innerText += "Altitude : " + position.coords.altitude + "\n";
        wOutput.innerText += "Accuracy : " + position.coords.accuracy + "\n";
        wOutput.innerText += "Altitude Accuracy : " + position.coords.altitudeAccuracy + "\n";
        wOutput.innerText += "Heading : " + position.coords.heading + "\n";
        wOutput.innerText += "Speed : " + position.coords.speed + "\n";
        
        wOutput.innerText += "TimeStamp : " + position.timestamp + "\n";
      }

      init();
</script>
  </body>
</html>